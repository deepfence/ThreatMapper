/* eslint-disable */
import React from 'react';
import { connect, useDispatch } from 'react-redux';
import RadialBarChart from '../common/charts/radial-bar-chart/index';
import { setSearchQuery } from '../../actions/app-actions';
import { constructGlobalSearchQuery } from '../../utils/search-utils';
import { getSeverityColor } from '../../constants/colors';

const CVESeverityReport = props => {
  const dispatch = useDispatch();

  const getActiveStyle = ({ type }) => {
    return {
      fill: getSeverityColor(type, true),
      stroke: 0,
    };
  };

  const sectionClickHandler = point => {
    const {
      globalSearchQuery: existingQuery = [],
    } = props;

    let searchQuery = [];
    if (point.type) {
      const severityParams = {
        cve_severity: point.type,
      };
      searchQuery = constructGlobalSearchQuery(existingQuery, severityParams);
    }

    if (point.cve_type) {
      const cveTypeParams = {
        cve_type: point.cve_type,
      };
      searchQuery = constructGlobalSearchQuery(searchQuery, cveTypeParams);
    }

    const globalSearchQuery = {
      searchQuery,
    };
    dispatch(setSearchQuery(globalSearchQuery));
  };

  const { summaryStats } = props;
  /* eslint-disable */
  return (
    <div>
      <div className="unique-vulnerabilities">Unique Vulnerabilities</div>
      {summaryStats && (
        <RadialBarChart
          data={summaryStats}
          chartHeight={600}
          chartWidth={580}
          stacking={true}
          onSectionClick={point => sectionClickHandler(point)}
          colorCb={({ type }) => getSeverityColor(type, false)}
          colorShadeCb={({ data }) => getActiveStyle(data)}
        />
      )}
    </div>
  );
};

const mapStateToProps = state => ({
  summaryStats: state.getIn(['cve', 'severity_report_view', 'summary_stats']),
});

export default connect(mapStateToProps)(CVESeverityReport);
